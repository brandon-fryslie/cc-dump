This file is a merged representation of a subset of the codebase, containing specifically included files, combined into a single document by Repomix.
The content has been processed where content has been compressed (code blocks are separated by ⋮---- delimiter).

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of a subset of the repository's contents that is considered the most important context.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Only files matching these patterns are included: src/textual/widgets/_input.py
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Content has been compressed - code blocks are separated by ⋮---- delimiter
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
src/
  textual/
    widgets/
      _input.py
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="src/textual/widgets/_input.py">
InputValidationOn = Literal["blur", "changed", "submitted"]
"""Possible messages that trigger input validation."""
_POSSIBLE_VALIDATE_ON_VALUES = {"blur", "changed", "submitted"}
"""Set literal with the legal values for the type `InputValidationOn`."""
⋮----
_RESTRICT_TYPES = {
InputType = Literal["integer", "number", "text"]
⋮----
class Selection(NamedTuple)
⋮----
"""A range of selected text within the Input.

    Text can be selected by clicking and dragging the mouse, or by pressing
    shift+arrow keys.

    Attributes:
        start: The start index of the selection.
        end: The end index of the selection.
    """
⋮----
start: int
end: int
⋮----
@classmethod
    def cursor(cls, cursor_position: int) -> Selection
⋮----
"""Create a selection from a cursor position."""
⋮----
@property
    def is_empty(self) -> bool
⋮----
"""Return True if the selection is empty."""
⋮----
class Input(ScrollView)
⋮----
"""A text input widget."""
⋮----
BINDING_GROUP_TITLE = "Input"
BINDINGS: ClassVar[list[BindingType]] = [
"""
    | Key(s) | Description |
    | :- | :- |
    | left | Move the cursor left. |
    | shift+left | Move cursor left and select. |
    | ctrl+left | Move the cursor one word to the left. |
    | right | Move the cursor right or accept the completion suggestion. |
    | ctrl+shift+left | Move cursor left a word and select. |
    | shift+right | Move cursor right and select. |
    | ctrl+right | Move the cursor one word to the right. |
    | backspace | Delete the character to the left of the cursor. |
    | ctrl+shift+right | Move cursor right a word and select. |
    | ctrl+shift+a | Select all text in the input. |
    | home,ctrl+a | Go to the beginning of the input. |
    | end,ctrl+e | Go to the end of the input. |
    | shift+home | Select up to the input start. |
    | shift+end | Select up to the input end. |
    | delete,ctrl+d | Delete the character to the right of the cursor. |
    | enter | Submit the current value of the input. |
    | ctrl+w | Delete the word to the left of the cursor. |
    | ctrl+u | Delete everything to the left of the cursor. |
    | ctrl+f | Delete the word to the right of the cursor. |
    | ctrl+k | Delete everything to the right of the cursor. |
    | ctrl+x | Cut selected text. |
    | ctrl+c | Copy selected text. |
    | ctrl+v | Paste text from the clipboard. | 
    """
⋮----
COMPONENT_CLASSES: ClassVar[set[str]] = {
"""
    | Class | Description |
    | :- | :- |
    | `input--cursor` | Target the cursor. |
    | `input--placeholder` | Target the placeholder text (when it exists). |
    | `input--suggestion` | Target the auto-completion suggestion (when it exists). |
    | `input--selection` | Target the selected text. |
    """
⋮----
DEFAULT_CSS = """
⋮----
cursor_blink = reactive(True, init=False)
# TODO - check with width: auto to see if layout=True is needed
value: Reactive[str] = reactive("", init=False)
⋮----
@property
    def cursor_position(self) -> int
⋮----
"""The current position of the cursor, corresponding to the end of the selection."""
⋮----
@cursor_position.setter
    def cursor_position(self, position: int) -> None
⋮----
"""Set the current position of the cursor."""
⋮----
selection: Reactive[Selection] = reactive(Selection.cursor(0))
"""The currently selected range of text."""
⋮----
placeholder = reactive("")
_cursor_visible = reactive(True)
password = reactive(False)
suggester: Suggester | None
"""The suggester used to provide completions as the user types."""
_suggestion = reactive("")
"""A completion suggestion for the current value in the input."""
restrict = var["str | None"](None)
"""A regular expression to limit changes in value."""
type = var[InputType]("text")
"""The type of the input."""
max_length = var["int | None"](None)
"""The maximum length of the input, in characters."""
valid_empty = var(False)
"""Empty values should pass validation."""
compact = reactive(False, toggle_class="-textual-compact")
"""Make the input compact (without borders)."""
⋮----
@dataclass
    class Changed(Message)
⋮----
"""Posted when the value changes.

        Can be handled using `on_input_changed` in a subclass of `Input` or in a parent
        widget in the DOM.
        """
⋮----
input: Input
"""The `Input` widget that was changed."""
⋮----
value: str
"""The value that the input was changed to."""
⋮----
validation_result: ValidationResult | None = None
"""The result of validating the value (formed by combining the results from each validator), or None
            if validation was not performed (for example when no validators are specified in the `Input`s init)"""
⋮----
@property
        def control(self) -> Input
⋮----
"""Alias for self.input."""
⋮----
@dataclass
    class Submitted(Message)
⋮----
"""Posted when the enter key is pressed within an `Input`.

        Can be handled using `on_input_submitted` in a subclass of `Input` or in a
        parent widget in the DOM.
        """
⋮----
"""The `Input` widget that is being submitted."""
⋮----
"""The value of the `Input` being submitted."""
⋮----
"""The result of validating the value on submission, formed by combining the results for each validator.
        This value will be None if no validation was performed, which will be the case if no validators are supplied
        to the corresponding `Input` widget."""
⋮----
@dataclass
    class Blurred(Message)
⋮----
"""Posted when the widget is blurred (loses focus).

        Can be handled using `on_input_blurred` in a subclass of `Input` or in a parent
        widget in the DOM.
        """
⋮----
"""Initialise the `Input` widget.

        Args:
            value: An optional default value for the input.
            placeholder: Optional placeholder text for the input.
            highlighter: An optional highlighter for the input.
            password: Flag to say if the field should obfuscate its content.
            restrict: A regex to restrict character inputs.
            type: The type of the input.
            max_length: The maximum length of the input, or 0 for no maximum length.
            suggester: [`Suggester`][textual.suggester.Suggester] associated with this
                input instance.
            validators: An iterable of validators that the Input value will be checked against.
            validate_on: Zero or more of the values "blur", "changed", and "submitted",
                which determine when to do input validation. The default is to do
                validation for all messages.
            valid_empty: Empty values are valid.
            select_on_focus: Whether to select all text on focus.
            name: Optional name for the input widget.
            id: Optional ID for the widget.
            classes: Optional initial classes for the widget.
            disabled: Whether the input is disabled or not.
            tooltip: Optional tooltip.
            compact: Enable compact style (without borders).
        """
⋮----
"""Timer controlling the blinking of the cursor, instantiated in `on_mount`."""
⋮----
# Ensure we always end up with an Iterable of validators
⋮----
"""Set with event names to do input validation on.

        Validation can only be performed on blur, on input changes and on input submission.

        Example:
            This creates an `Input` widget that only gets validated when the value
            is submitted explicitly:

            ```py
            input = Input(validate_on=["submitted"])
            ```
        """
⋮----
"""True if the user is selecting text with the mouse."""
⋮----
"""Indicates if the value has been set for the first time yet."""
⋮----
def _position_to_cell(self, position: int) -> int
⋮----
"""Convert an index within the value to cell position.

        Args:
            position: The index within the value to convert.

        Returns:
            The cell position corresponding to the index.
        """
⋮----
@property
    def _cursor_offset(self) -> int
⋮----
"""The cell offset of the cursor."""
offset = self._position_to_cell(self.cursor_position)
⋮----
@property
    def cursor_at_start(self) -> bool
⋮----
"""Flag to indicate if the cursor is at the start."""
⋮----
@property
    def cursor_at_end(self) -> bool
⋮----
"""Flag to indicate if the cursor is at the end."""
⋮----
def check_consume_key(self, key: str, character: str | None) -> bool
⋮----
"""Check if the widget may consume the given key.

        As an input we are expecting to capture printable keys.

        Args:
            key: A key identifier.
            character: A character associated with the key, or `None` if there isn't one.

        Returns:
            `True` if the widget may capture the key in its `Key` message, or `False` if it won't.
        """
⋮----
def validate_selection(self, selection: Selection) -> Selection
⋮----
value_length = len(self.value)
⋮----
def _watch_selection(self, selection: Selection) -> None
⋮----
def _watch_cursor_blink(self, blink: bool) -> None
⋮----
"""Ensure we handle updating the cursor blink at runtime."""
⋮----
@property
    def cursor_screen_offset(self) -> Offset
⋮----
"""The offset of the cursor of this input in screen-space. (x, y)/(column, row)."""
⋮----
def _watch_value(self, value: str) -> None
⋮----
"""Update the virtual size and suggestion when the value changes."""
⋮----
validation_result = (
⋮----
# If this is the first time the value has been updated, set the cursor position to the end
⋮----
# Force a re-validation of the selection to ensure it accounts for
# the length of the new value
⋮----
def _watch_valid_empty(self) -> None
⋮----
"""Repeat validation when valid_empty changes."""
⋮----
def validate(self, value: str) -> ValidationResult | None
⋮----
"""Run all the validators associated with this Input on the supplied value.

        Runs all validators, combines the result into one. If any of the validators
        failed, the combined result will be a failure. If no validators are present,
        None will be returned. This also sets the `-invalid` CSS class on the Input
        if the validation fails, and sets the `-valid` CSS class on the Input if
        the validation succeeds.

        Returns:
            A ValidationResult indicating whether *all* validators succeeded or not.
                That is, if *any* validator fails, the result will be an unsuccessful
                validation.
        """
⋮----
def set_classes() -> None
⋮----
"""Set classes for valid flag."""
valid = self._valid
⋮----
# If no validators are supplied, and therefore no validation occurs, we return None.
⋮----
validation_results: list[ValidationResult] = [
combined_result = ValidationResult.merge(validation_results)
⋮----
@property
    def is_valid(self) -> bool
⋮----
"""Check if the value has passed validation."""
⋮----
def render_line(self, y: int) -> Strip
⋮----
console = self.app.console
console_options = self.app.console_options
max_content_width = self.scrollable_content_region.width
⋮----
placeholder = Text(self.placeholder, justify="left", end="")
⋮----
cursor_style = self.get_component_rich_style("input--cursor")
⋮----
# If the placeholder is empty, there's no characters to stylise
# to make the cursor flash, so use a single space character
⋮----
placeholder = Text(" ", end="")
⋮----
strip = Strip(
⋮----
result = self._value
⋮----
# Add the completion with a faded style.
value = self.value
value_length = len(value)
suggestion = self._suggestion
show_suggestion = len(suggestion) > value_length and self.has_focus
⋮----
selection_style = self.get_component_rich_style("input--selection")
⋮----
cursor = self.cursor_position
⋮----
segments = list(
⋮----
strip = Strip(segments)
⋮----
strip = strip.crop(scroll_x, scroll_x + max_content_width + 1)
strip = strip.extend_cell_length(max_content_width + 1)
⋮----
@property
    def _value(self) -> Text
⋮----
"""Value rendered as text."""
⋮----
text = Text(self.value, no_wrap=True, overflow="ignore", end="")
⋮----
text = self.highlighter(text)
⋮----
@property
    def content_width(self) -> int
⋮----
"""The width of the content."""
⋮----
# Extra space for cursor at the end.
⋮----
def get_content_width(self, container: Size, viewport: Size) -> int
⋮----
"""Get the widget of the content."""
⋮----
def get_content_height(self, container: Size, viewport: Size, width: int) -> int
⋮----
def _toggle_cursor(self) -> None
⋮----
"""Toggle visibility of cursor."""
⋮----
def _on_mount(self, event: Mount) -> None
⋮----
def text_selection_started(screen: Screen) -> None
⋮----
"""Signal callback to unselect when arbitrary text selection starts."""
⋮----
def _on_blur(self, event: Blur) -> None
⋮----
def _on_focus(self, event: Focus) -> None
⋮----
async def _on_key(self, event: events.Key) -> None
⋮----
selection = self.selection
⋮----
def _on_paste(self, event: events.Paste) -> None
⋮----
line = event.text.splitlines()[0]
⋮----
def _cell_offset_to_index(self, offset: int) -> int
⋮----
"""Convert a cell offset to a character index, accounting for character width.

        Args:
            offset: The cell offset to convert.

        Returns:
            The character index corresponding to the cell offset.
        """
cell_offset = 0
_cell_size = get_character_cell_size
⋮----
cell_width = _cell_size(char)
⋮----
async def _on_mouse_down(self, event: events.MouseDown) -> None
⋮----
def _end_selecting(self) -> None
⋮----
"""End selecting if it is currently active."""
⋮----
async def _on_mouse_release(self, _event: events.MouseRelease) -> None
⋮----
async def _on_mouse_up(self, _event: events.MouseUp) -> None
⋮----
async def _on_mouse_move(self, event: events.MouseMove) -> None
⋮----
# As we drag the mouse, we update the end position of the selection,
# keeping the start position fixed.
offset = event.get_content_offset_capture(self)
⋮----
async def _on_suggestion_ready(self, event: SuggestionReady) -> None
⋮----
"""Handle suggestion messages and set the suggestion when relevant."""
⋮----
def _restart_blink(self) -> None
⋮----
"""Restart the cursor blink cycle."""
⋮----
def _pause_blink(self, visible: bool = False) -> None
⋮----
"""Hide the blinking cursor and pause the blink cycle."""
⋮----
def insert_text_at_cursor(self, text: str) -> None
⋮----
"""Insert new text at the cursor, move the cursor to the end of the new text.

        Args:
            text: New text to insert.
        """
⋮----
def restricted(self) -> None
⋮----
"""Called when a character has been restricted.

        The default behavior is to play the system bell.
        You may want to override this method if you want to disable the bell or do something else entirely.
        """
⋮----
def clear(self) -> None
⋮----
"""Clear the input."""
⋮----
@property
    def selected_text(self) -> str
⋮----
"""The text between the start and end points of the current selection."""
⋮----
def action_cursor_left(self, select: bool = False) -> None
⋮----
"""Move the cursor one position to the left.

        Args:
            select: If `True`, select the text to the left of the cursor.
        """
⋮----
def action_cursor_right(self, select: bool = False) -> None
⋮----
"""Accept an auto-completion or move the cursor one position to the right.

        Args:
            select: If `True`, select the text to the right of the cursor.
        """
⋮----
def select_all(self) -> None
⋮----
"""Select all of the text in the Input."""
⋮----
def action_select_all(self) -> None
⋮----
def action_home(self, select: bool = False) -> None
⋮----
"""Move the cursor to the start of the input.

        Args:
            select: If `True`, select the text between the old and new cursor positions.
        """
⋮----
def action_end(self, select: bool = False) -> None
⋮----
"""Move the cursor to the end of the input.

        Args:
            select: If `True`, select the text between the old and new cursor positions.
        """
⋮----
_WORD_START = re.compile(r"(?<=\W)\w")
⋮----
def action_cursor_left_word(self, select: bool = False) -> None
⋮----
"""Move the cursor left to the start of a word.

        Args:
            select: If `True`, select the text between the old and new cursor positions.
        """
⋮----
# This is a password field so don't give any hints about word
# boundaries, even during movement.
⋮----
target = 0
⋮----
target = hit.start()
⋮----
def action_cursor_right_word(self, select: bool = False) -> None
⋮----
"""Move the cursor right to the start of a word.

        Args:
            select: If `True`, select the text between the old and new cursor positions.
        """
⋮----
hit = re.search(self._WORD_START, self.value[self.cursor_position :])
⋮----
target = len(self.value)
⋮----
target = end + hit.start()
⋮----
def replace(self, text: str, start: int, end: int) -> None
⋮----
"""Replace the text between the start and end locations with the given text.

        Args:
            text: Text to replace the existing text with.
            start: Start index to replace (inclusive).
            end: End index to replace (inclusive).
        """
⋮----
def check_allowed_value(value: str) -> bool
⋮----
"""Check if new value is restricted."""
⋮----
# Check max length
⋮----
# Check explicit restrict
⋮----
# Check type restrict
⋮----
type_restrict = _RESTRICT_TYPES.get(self.type, None)
⋮----
# Character is allowed
⋮----
new_value = f"{value[:start]}{text}{value[end:]}"
⋮----
def insert(self, text: str, index: int) -> None
⋮----
"""Insert text at the given index.

        Args:
            text: Text to insert.
            index: Index to insert the text at (inclusive).
        """
⋮----
def delete(self, start: int, end: int) -> None
⋮----
"""Delete the text between the start and end locations.

        Args:
            start: Start index to delete (inclusive).
            end: End index to delete (inclusive).
        """
⋮----
def delete_selection(self) -> None
⋮----
"""Delete the current selection."""
⋮----
def action_delete_right(self) -> None
⋮----
"""Delete one character at the current cursor position."""
⋮----
def action_delete_right_word(self) -> None
⋮----
"""Delete the current character and all rightward to the start of the next word."""
⋮----
# boundaries, even during deletion.
⋮----
after = self.value[self.cursor_position :]
hit = re.search(self._WORD_START, after)
⋮----
start = self.cursor_position
end = start + hit.end() - 1
⋮----
def action_delete_right_all(self) -> None
⋮----
"""Delete the current character and all characters to the right of the cursor position."""
⋮----
def action_delete_left(self) -> None
⋮----
"""Delete one character to the left of the current cursor position."""
⋮----
def action_delete_left_word(self) -> None
⋮----
"""Delete leftward of the cursor position to the start of a word."""
⋮----
def action_delete_left_all(self) -> None
⋮----
"""Delete all characters to the left of the cursor position."""
⋮----
async def action_submit(self) -> None
⋮----
"""Handle a submit action.

        Normally triggered by the user pressing Enter. This may also run any validators.
        """
⋮----
def action_cut(self) -> None
⋮----
"""Cut the current selection (copy to clipboard and remove from input)."""
⋮----
def action_copy(self) -> None
⋮----
"""Copy the current selection to the clipboard."""
selected_text = self.selected_text
⋮----
def action_paste(self) -> None
⋮----
"""Paste from the local clipboard."""
clipboard = self.app.clipboard
</file>

</files>
